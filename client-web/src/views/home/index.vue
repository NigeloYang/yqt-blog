<template>
	<section class="home-container" id="home">
		<!--ç‰¹æ•ˆæ¸²æŸ“é¡µ-->
		<Intro @moss="scrollToSection1"/>
		<!--ä¸»è¦å†…å®¹-->
		<section class="main-warp" id="about">
			<!--ä¸»è¦å†…å®¹ èƒŒæ™¯banner-->
			<section class="banner">
				<img class="banner-cover" alt="banner" src="@/assets/img/banner.jpg">
				<div class="banner-content">
					<div class="banner-container">
						<div class="row">
							<div class="row-col-left"></div>
							<div class="row-col-right">
								<div class="banner-text" :style="`transform: translateX(-${state.titleAnimation?0:50}%)`">
									<p class="text-tip">Hi! I'm {{ setting.websiteInfo.name || 'Richard Yang' }}</p>
									<p class="text-main">
										{{ setting.websiteInfo.motto || "Welcome To My Personal Homepage! Let's Go!" }}</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>

			<!--ä¸»è¦å†…å®¹ å±•ç¤ºå†…å®¹-->
			<section class="main-container">

				<!--ä¸»è¦å†…å®¹ ä¸ªäººç®€ä»‹-->
				<div class="container-row">
					<div class="container-left">
						<div class="sidebar" :style="`transform: translateY(-${state.titleAnimation?40:0}%)`">
							<div class="sidebar-card">
								<div class="sidebar-avatar">
									<!--									<img class="avatar-img lazy-image " :data-src="`https://www.vickyadrii.my.id/images/about-image.svg`">-->
									<img class="avatar-img lazy-image " src="@/assets/img/yqt.jpg">
								</div>
								<div class="sidebar-name">{{ setting.websiteInfo.occupation }}</div>
								<div class="sidebar-label">{{ setting.websiteInfo.occupationEn }}</div>
								<div class="c-divider c-mb-40"></div>
								<div class="sidebar-social">
									<GitlabOutlined/>
									<a :href="setting.userInfo.github" target="_blank">GitHub<i class="iconfont icon-github"></i></a>
									<a :href="setting.userInfo.gitee" target="_blank">Gitee<i class="iconfont icon-gitee"></i></a>
									<!--									<a href="https://github.com" target="_blank">GitHub<i class="iconfont icon-github"></i></a>-->
									<!--									<a href="https://github.com" target="_blank">Gitee<i class="iconfont icon-gitee"></i></a>-->
								</div>
								<div class="c-divider c-mb-40 c-mt-40"></div>
								<ul class="sidebar-other">
									<li class="other-item">
										<span class="item-label">åŸå¸‚ï¼š</span>
										<span class="item-label-light">{{ setting.userInfo.city || '-' }}</span>
									</li>
									<li class="other-item">
										<span class="item-label">å¹´é¾„ï¼š</span>
										<span class="item-label-light">{{ setting.userInfo.age }}</span>
									</li>

									<li class="other-item">
										<span class="item-label">å¾®ä¿¡/QQï¼š</span>
									</li>
									<div class="social">
										<!--										<img width="80"-->
										<!--												 class="lazy-image"-->
										<!--												 :data-src="setting.userInfo.wx">-->
										<!--										<img width="80"-->
										<!--												 class="lazy-image"-->
										<!--												 :data-src="setting.userInfo.qq">-->
										<img width="80" class="profile-logo" src="@/assets/img/yqt.jpg">
										<img width="80" class="profile-logo" src="@/assets/img/yqt.jpg">
									</div>
								</ul>
								<div class="c-divider c-mb-40"></div>

								<div class="sidebar-btn" @click="scrollToSection1('contact')">
									<span>åœ¨çº¿ç•™è¨€</span>
									<!--                  <i class="iconfont icon-github"></i>-->
								</div>
								<span class="downResume" v-if="setting.userInfo.showResumeUrl" @click="downloadResume">ä¸‹è½½ç®€å†</span>
							</div>
						</div>
					</div>
					<div class="container-right">
						<div class="container-right-content">
							<div class="brand-card-list">
								<div class="brand-card-item">
									<div class="card-item">
										<h3 class="card-item-title">14+</h3>
										<div class="c-divider"></div>
										<div class="card-item-content">å¼€æºé¡¹ç›®</div>
									</div>
								</div>
								<div class="brand-card-item">
									<div class="card-item">
										<h3 class="card-item-title">3 +</h3>
										<div class="c-divider"></div>
										<div class="card-item-content">å®æˆ˜ç»éªŒ</div>
									</div>
								</div>
								<div class="brand-card-item">
									<div class="card-item">
										<h3 class="card-item-title">50+</h3>
										<div class="c-divider"></div>
										<div class="card-item-content">é¡¹ç›®åˆä½œ</div>
									</div>
								</div>
							</div>
							<section class="notice ">
								<div class="notice-line">
									<span class="notice-title">ğŸ“¢ NOTICEï¼š</span>
									<div class="notice-desc">
										{{ setting.websiteInfo.notice || '-' }}
									</div>
								</div>
							</section>
							<section class="brand-tips">
								<YqtSectionHeader title="Tips" titleNum="01"/>
								<blockquote class="my-story">
									æ— è¶£çš„äººæƒ³è¿‡ç€æœ‰è¶£çš„ç”Ÿæ´»ã€‚
									<br/>
									æ¯ä¸€æ­¥éƒ½æ˜¯å¥‡è¿¹ï¼Œæ¯ä¸€å¤©éƒ½æ˜¯æ–°çš„èµ·ç‚¹ã€‚
									<!--									<img class="wx-logo lazy-image" width="120"-->
									<!--											 :data-src="setting.websiteInfo.wxMini">-->
									<img class="wx-logo lazy-image" width="120"
											 src="@/assets/img/yqt.jpg"
									>
								</blockquote>
							</section>
						</div>
					</div>
				</div>

				<!--ä¸»è¦å†…å®¹ é‡è¦æç¤º-->
				<section class="notice notice-temp c-mb-40">
					<div class="notice-line">
						<span class="notice-title">å…¬å‘Šï¼š</span>
						<div class="notice-desc">{{ setting.websiteInfo.notice || '-' }}
						</div>
					</div>
				</section>

				<!--ä¸»è¦å†…å®¹ æ–‡å­—ä»‹ç»-->
				<section class="about">
					<YqtSectionHeader title="Tips" titleNum="02"/>
					<section class="animate-me">
						"<span class="me-text me-text-a">ä¸‰å¹´å‰</span>ï¼Œæˆ‘è¸ä¸Šäº†<span class="me-text me-text-b">å‰ç«¯å¼€å‘</span>çš„æ—…ç¨‹
						ï¼Œä»é‚£æ—¶èµ·ï¼Œå¯¹å‰ç«¯æŠ€æœ¯<span class="me-text me-text-c">å……æ»¡çƒ­æƒ…</span>ï¼Œ
						å¹¶è¿«ä¸åŠå¾…åœ°æ„å»ºå„ç§<span class="me-text me-text-d">å“åº”å¼</span>è®¾è®¡å’Œ<span class="me-text me-text-c">ç§»åŠ¨ç«¯</span>çš„å¼€å‘ã€‚æˆ‘æ¯”è¾ƒæ³¨é‡
						<span class="me-text me-text-e">ç”¨æˆ·ä½“éªŒ</span>ã€ç•Œé¢è®¾è®¡å’Œ<span class="me-text me-text-a">ä»£ç è´¨é‡</span>ï¼Œå¹¶å…·æœ‰<span
						class="me-text me-text-c">ä¼˜åŒ–æ€§èƒ½</span>å’Œè§£å†³å…¼å®¹æ€§é—®é¢˜çš„ç»éªŒã€‚
						çƒ­è¡·äº<span class="me-text me-text-c">åˆ›æ–°</span>æ€ç»´ï¼Œå–œæ¬¢æ€è€ƒå’Œ
						<span class="me-text me-text-c">è§£å†³é—®é¢˜</span>ã€‚è¿½æ±‚è‡ªå·±çš„å…´è¶£å’Œæ¿€æƒ…ï¼Œè®©æ¯ä¸€å¤©éƒ½å……æ»¡<span class="me-text me-text-c">æ´»åŠ›</span>å’Œä¹è¶£
					</section>
				</section>

				<!--ä¸»è¦å†…å®¹ åšå®¢æ–‡ç« å±•ç¤º-->
				<section class="blog c-mt-40 c-mb-40" id="blog">
					<YqtSectionHeader title="Selected Articles" titleNum="03"/>
					<ArticleSection/>
				</section>

				<!--ä¸»è¦å†…å®¹ è”ç³»æ¨¡å—-->
				<section class="connect c-mt-40 c-mb-40" id="contact">
					<YqtSectionHeader title="Contact Me" titleNum="04"/>
					<p class="message-tips">ç•™ä¸‹ä½ çš„è¶³è¿¹ï¼Œè®©æˆ‘çŸ¥é“ä½ åœ¨è¿™é‡Œçœ‹è¿‡æˆ‘çš„ç•™è¨€æ¿ã€‚</p>
					<div class="connect-bos">
						<div class="contact-form">
							<YqtForm @submitForm="submitMessage"/>
						</div>
						<ul class="contact-basic">
							<li class="basic-item" v-for="item in state.messageList" :key="item._id">
								<a-avatar :size="40" :src="item.userInfo[0].avatar" alt="åŒ¿å"/>
								<a-avatar :size="40" v-if="!item.userInfo[0].avatar">
									<template #icon>
										<i style="font-size:1.6rem" class="iconfont icon-customer-bussinessmam"></i>
									</template>
								</a-avatar>
								<div class="item-r">
									<p class="r-t">
										<span class="r-t-name">{{ item.userInfo[0].nickname }}</span>
										<span class="author" v-if="item.userInfo[0].username==='admin'"></span>
										<span class="r-t-time">{{ TimeUtils.formatRelativeTime(item.createdAt) }}</span>
									</p>
								</div>
							</li>
							<li class="more-msg" @click="goToPage('/contact')">
								<i class="iconfont icon-click"></i> æŸ¥çœ‹æ›´å¤š
							</li>
						</ul>
					</div>
				</section>

			</section>
		</section>

		<!--åœ°ç†ä½ç½®æ¨¡å—-->
		<WorldMap/>

		<YqtModal :minWidth="350" :show="state.show.work" title="é¡¹ç›®è¯¦æƒ…" key="ViewUserInfo" @close="close">
			<WorkDetail :viewData="state.viewData"></WorkDetail>
		</YqtModal>

	</section>
</template>

<script setup>
import {onMounted, onBeforeUnmount, nextTick, watch, reactive} from 'vue';
import {useRouter} from 'vue-router'

import YqtSectionHeader from "../../components/common/YqtSectionHeader.vue"
import YqtForm from "../../components/common/YqtForm.vue"
import YqtModal from "../../components/common/YqtModal.vue"
import WorkDetail from "../../components/common/WorkDetail.vue"

import Intro from "./components/intro.vue"
import ArticleSection from "./components/ArticleSection.vue"
import WorldMap from "./components/WorldMap.vue"

import {goToPage} from "../../utils/util.router";
import lazyLoadImages from "../../utils/util.lazyLoad";
import {TimeUtils} from "../../utils/util.time";
import observeAndAnimate from "../../utils/util.viewportObserve";

import {useMenusStore} from '../../stores/menus'

import {portfoliosList} from "../../api/modules/api.portfolios";
import {messagesCreate, messagesList} from "../../api/modules/api.messages";

import setting from "../../setting"

const router = useRouter()
const menusAction = useMenusStore()

const state = reactive({
	scrollHeight: 0,
	bannerWidth: 100,
	titleAnimation: true,
	textAnimation: false,
	show: {
		work: false
	},
	portfoliosQuery: {
		params: {
			recommended: true,
			status: true,
		},
		pagination: {
			current: 1,
			pageSize: 5,
		},
	},
	portfoliosData: [],
	viewData: {},
	messageQuery: {
		pagination: {
			current: 1,
			pageSize: 5,
		},
	},
	messageList: []
})

// æ•°æ®æ›´æ–°åä½¿ç”¨ nextTick æ¥ç¡®ä¿åœ¨ DOM æ›´æ–°åæ‰§è¡Œ lazyLoadImages æ–¹æ³•
watch(() => state.portfoliosData, () => {
	nextTick(() => {
		lazyLoadImages();
	})
});

const scrollToSection1 = (id) => {
	const dom = document.getElementById(id)
	dom.scrollIntoView({behavior: 'smooth'});
}

watch(() => menusAction.page, (val) => {
	if (val) {
		scrollToSection1(val)
	}
})

const downloadResume = () => {
	alert('æŠ±æ­‰ï¼åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...')
}

const submitMessage = (form) => {
	messagesCreate(form).then(res => {
		if (res.status) {
			let info = {
				name: form.name,
				email: form.email,
				website: form.website
			}
			localStorage.setItem('YQT-CLIENT-USERINFO', JSON.stringify(info))
			getMessageList()
		}
	})
}

const getMessageList = () => {
	messagesList(state.messageQuery).then(res => {
		state.messageList = res.data.result
	})
}

getMessageList()

const handleScroll = (e) => {
	// æ»šåŠ¨äº‹ä»¶å¤„ç†é€»è¾‘
	state.titleAnimation = window.scrollY - window.innerHeight / 2.2 > 0;
};

const getPortfolioList = () => {
	portfoliosList(state.portfoliosQuery).then(res => {
		state.portfoliosData = res.data.result || []
	})
}

getPortfolioList()

onMounted(() => {
	window.addEventListener('scroll', handleScroll);

	observeAndAnimate('.news-block-two', (element) => {
		// è‡ªå®šä¹‰åŠ¨ç”»æ•ˆæœ
		element.style.opacity = 1;
		element.style.transform = 'translateX(0px)';
	});

	observeAndAnimate('.box-item', (element) => {
		// è‡ªå®šä¹‰åŠ¨ç”»æ•ˆæœ
		element.style.opacity = 1;
		element.style.transform = 'translateY(0px)';
	});

	// æ‡’åŠ è½½å›¾ç‰‡
	lazyLoadImages();

})

onBeforeUnmount(() => {
	window.removeEventListener('scroll', handleScroll);
});

</script>

<style scoped lang="scss">
@import "style/index";
</style>
